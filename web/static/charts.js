var bar_chart,clear_charts,line_chart,make_title,multiple_main_key,overview_bar_chart,plot_single_data_charts,plot_weekly_data_charts,singular_main_key,split_keys,sum,sum_prime;console.log("charts-coffee.coffee loaded.");sum=function(e){return e.reduce(function(e,t){return e+t})};sum_prime=function(e){return e.reduce(function(e,t){return e+t[0]})};make_title=function(e,t){return"Requests `"+e+"' per Hour (total: "+sum(t)+")"};bar_chart=function(e,t,n,r){return $.jqplot(t,n,{title:e,animate:!$.jqplot.use_excanvas,seriesDefaults:{renderer:$.jqplot.BarRenderer,pointLabels:{show:true}},axes:{xaxis:{renderer:$.jqplot.CategoryAxisRenderer,ticks:r},yaxis:{pad:0}}})};line_chart=function(e,t,n,r){return $.jqplot(t,n,{title:e,axesDefaults:{labelRenderer:$.jqplot.CanvasAxisLabelRenderer},axes:{xaxis:{renderer:$.jqplot.CategoryAxisRenderer,ticks:r}}})};overview_bar_chart=function(e,t,n,r,i){return $.jqplot(t,r,{title:e,animate:!$.jqplot.use_excanvas,stackSeries:false,showMarker:false,highlighter:{show:true,showTooltip:false},seriesDefaults:{renderer:$.jqplot.BarRenderer,rendererOptions:{barDirection:"vertical",barMargin:30,highlightMouseOver:true},pointLabels:{show:true,edgeTolerance:-15}},series:n.map(function(e){return{label:e}}),axes:{xaxis:{renderer:$.jqplot.CategoryAxisRenderer,ticks:i},yaxis:{pad:1.2}},legend:{show:true,location:"e",placement:"outsideGrid"}})};$.jqplot.config.enablePlugins=true;multiple_main_key=["stop","line","news","stop2stop","total"];singular_main_key=["client","param"];clear_charts=function(e,t,n){var r,i,s,o,u,a,f,l,c,h;if(t==null){t=multiple_main_key}if(n==null){n=singular_main_key}$('[id^="indicator"]').show();for(s=0,a=t.length;s<a;s++){r=t[s];$("#indicator_"+r+"_overview").show();if(e[r]){c=e[r];for(o=0,f=c.length;o<f;o++){i=c[o];$("#indicator_"+r+"_"+i).show();if(e[r][i]){console.log(e[r][i]);e[r][i].destroy();console.log(e[r][i])}}}}h=[];for(u=0,l=n.length;u<l;u++){r=n[u];if(e[r]){h.push(e[r].destroy())}else{h.push(void 0)}}return h};split_keys=function(e){return function(e){var t,n;n=e[0],t=e[1];return t.split("_")}(e.split("#"))};plot_single_data_charts=function(e,t,n){clear_charts(n);return $.post(e,t,function(e){var t,r,i,s,o,u,a;o=e["time_slice_names"];$("#indicator_client").hide();n["client"]=line_chart(make_title("client",e["client"]),"client_div",[e["client"]],o);$("#indicator_param").hide();n["param"]=line_chart(make_title("param!get",e["param"]["pget"]),"param_div",[e["param"]["pget"]],o);r=["total","stop","line","news","stop2stop"];for(u=0,a=r.length;u<a;u++){t=r[u];i="overview";s=e[t][i];console.log(""+t+"_overview_div");$("#indicator_"+t+"_"+i).hide();n[t][i]=overview_bar_chart("Overview of `"+t+"' (total: "+sum_prime(e[t][i][1])+")",""+t+"_overview_div",s[0],s[1],[])}return $("#main").bind("shown",function(t){var r,i,s,u;u=split_keys(t.target.href),r=u[0],i=u[1],s=u[2];if(!n[r][i]){console.log(""+r+"_"+i+"_div");$("#indicator_"+r+"_"+i).hide();if(i!=="overview"){return n[r][i]=line_chart(make_title(""+r+"!"+i,e[r][i]),""+r+"_"+i+"_div",[e[r][i]],o)}}else{return n[r][i].replot()}})})};plot_weekly_data_charts=function(e){clear_charts(e,multiple_main_key.concat(["param"]),singular_main_key.filter(function(e){return e!=="param"}));return $.post("get_weekly_data",{},function(t){var n,r;r=t["ticks"];n=function(e,t,n){return line_chart(e,t,n,r)};$("#indicator_client").hide();e["client"]=n(make_title("client",t["client"]),"client_div",[t["client"]]);$("#indicator_total_overview").hide();e["total"]=n(make_title("total_overview",t["total_requests_per_day"]),"total_overview_div",[t["total_requests_per_day"]]);$("#main").bind("shown",function(r){var i,s,o,u;u=split_keys(r.target.href),i=u[0],s=u[1],o=u[2];if(!e[i][s]){console.log(""+i+"_"+s);$("#indicator_"+i+"_"+s).hide();return e[i][s]=n(make_title(""+i+"!"+s,t[i][s]),""+i+"_"+s+"_div",[t[i][s]])}else{return e[i][s].replot()}});return $('div[id*="overview"]').each(function(){var r,i,s,o;o=$(this).attr("id").split("_"),r=o[0],i=o[1],s=o[2];if($(this).attr("id")!=="total_overview_div"){$("#indicator_"+r+"_"+i).hide();return e[r][i]=n(make_title(""+r+"!"+i,t[r][i]),$(this).attr("id"),[t[r][i]])}})})}